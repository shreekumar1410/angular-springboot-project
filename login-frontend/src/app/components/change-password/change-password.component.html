<div class="change-password-container">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8">
        <div class="form-card">
          <div class="form-header">
            <h2 class="form-title">
              <i class="bi bi-key me-2"></i>Change Password
            </h2>
            <p class="form-subtitle">Update your account password</p>
          </div>

          <div class="form-body">
            <div *ngIf="errorMessage" class="alert-custom alert-danger-custom mb-4">
              <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage }}
            </div>

            <div *ngIf="successMessage" class="alert-custom alert-success-custom mb-4">
              <i class="bi bi-check-circle me-2"></i>{{ successMessage }}
            </div>

            <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
            <!-- Current Password -->
            <div class="form-group-custom mb-4">
              <label for="currentPassword" class="form-label-custom">
                <i class="bi bi-lock me-2"></i>Current Password <span class="text-danger">*</span>
              </label>
              <div class="password-input-wrapper">
                <input 
                  type="{{ showCurrentPassword ? 'text' : 'password' }}" 
                  class="form-control-custom" 
                  id="currentPassword" 
                  formControlName="currentPassword"
                  (input)="clearError()"
                  placeholder="Enter current password"
                  autocomplete="current-password">
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (click)="togglePasswordVisibility('current')"
                  [attr.aria-label]="showCurrentPassword ? 'Hide password' : 'Show password'">
                  <i class="bi" [ngClass]="showCurrentPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                </button>
              </div>
              <div *ngIf="changePasswordForm.get('currentPassword')!.invalid && changePasswordForm.get('currentPassword')!.touched" class="error-text">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="changePasswordForm.get('currentPassword')!.errors?.['required']">Current password is required</span>
              </div>
            </div>

            <!-- New Password -->
            <div class="form-group-custom mb-4">
              <label for="newPassword" class="form-label-custom">
                <i class="bi bi-lock-fill me-2"></i>New Password <span class="text-danger">*</span>
              </label>
              <div class="password-input-wrapper">
                <input 
                  type="{{ showNewPassword ? 'text' : 'password' }}" 
                  class="form-control-custom" 
                  id="newPassword" 
                  formControlName="newPassword"
                  (input)="clearError()"
                  placeholder="Enter new password"
                  autocomplete="new-password">
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (click)="togglePasswordVisibility('new')"
                  [attr.aria-label]="showNewPassword ? 'Hide password' : 'Show password'">
                  <i class="bi" [ngClass]="showNewPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                </button>
              </div>
              <div *ngIf="changePasswordForm.get('newPassword')!.invalid && changePasswordForm.get('newPassword')!.touched" class="error-text">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="changePasswordForm.get('newPassword')!.errors?.['required']">New password is required</span>
              </div>
            </div>

            <!-- Confirm New Password -->
            <div class="form-group-custom mb-4">
              <label for="confirmPassword" class="form-label-custom">
                <i class="bi bi-lock me-2"></i>Confirm New Password <span class="text-danger">*</span>
              </label>
              <div class="password-input-wrapper">
                <input 
                  type="{{ showConfirmPassword ? 'text' : 'password' }}" 
                  class="form-control-custom" 
                  id="confirmPassword" 
                  formControlName="confirmPassword"
                  (input)="clearError()"
                  placeholder="Confirm new password"
                  autocomplete="new-password">
                <button 
                  type="button" 
                  class="password-toggle-btn"
                  (click)="togglePasswordVisibility('confirm')"
                  [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'">
                  <i class="bi" [ngClass]="showConfirmPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                </button>
              </div>
              <div *ngIf="changePasswordForm.get('confirmPassword')!.invalid && changePasswordForm.get('confirmPassword')!.touched" class="error-text">
                <i class="bi bi-exclamation-circle me-1"></i>
                <span *ngIf="changePasswordForm.get('confirmPassword')!.errors?.['required']">Please confirm your new password</span>
                <span *ngIf="changePasswordForm.get('confirmPassword')!.errors?.['mismatch'] && !changePasswordForm.get('confirmPassword')!.errors?.['required']">Passwords do not match</span>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
              <button 
                type="submit" 
                class="btn-submit"
                [disabled]="isSubmitting || changePasswordForm.invalid">
                <span *ngIf="!isSubmitting">
                  <i class="bi bi-check-circle me-2"></i>Change Password
                </span>
                <span *ngIf="isSubmitting">
                  <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                  Changing Password...
                </span>
              </button>
              <a [routerLink]="getProfileRoute()" class="btn-cancel">
                <i class="bi bi-x-circle me-2"></i>Cancel
              </a>
            </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
